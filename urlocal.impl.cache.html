<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>urlocal.impl.cache documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name"></span> <span class="project-version"></span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>urlocal</span></div></div></li><li class="depth-2 branch"><a href="urlocal.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></div></li><li class="depth-3 branch current"><a href="urlocal.impl.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-3"><a href="urlocal.impl.xdg.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xdg</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="urlocal.impl.cache.html#var-base64-encode"><div class="inner"><span>base64-encode</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-cache-check-interval-secs-a"><div class="inner"><span>cache-check-interval-secs-a</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-cache-dir-a"><div class="inner"><span>cache-dir-a</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-cache-hit.21"><div class="inner"><span>cache-hit!</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-cache-key-.3Ecache-file"><div class="inner"><span>cache-key-&gt;cache-file</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-cache-miss.21"><div class="inner"><span>cache-miss!</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-check-cache.21"><div class="inner"><span>check-cache!</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-http-get"><div class="inner"><span>http-get</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-prep-cache.21"><div class="inner"><span>prep-cache!</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-remove-cache-entry.21"><div class="inner"><span>remove-cache-entry!</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-seconds-since"><div class="inner"><span>seconds-since</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-url-.3Econtent-file"><div class="inner"><span>url-&gt;content-file</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-url-.3Emetadata-file"><div class="inner"><span>url-&gt;metadata-file</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-write-metadata.21"><div class="inner"><span>write-metadata!</span></div></a></li><li class="depth-1"><a href="urlocal.impl.cache.html#var-write-metadata-file.21"><div class="inner"><span>write-metadata-file!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">urlocal.impl.cache</h1><div class="doc"><pre class="plaintext">This namespace is not part of the public API of urlocal and may change
without notice.</pre></div><div class="public anchor" id="var-base64-encode"><h3>base64-encode</h3><div class="usage"><code>(base64-encode x)</code></div><div class="doc"><pre class="plaintext">Returns a BASE64 encoded representation (a String) of the UTF-8 String
representation of x, or nil if x is nil</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L31">view source</a></div></div><div class="public anchor" id="var-cache-check-interval-secs-a"><h3>cache-check-interval-secs-a</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L29">view source</a></div></div><div class="public anchor" id="var-cache-dir-a"><h3>cache-dir-a</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L28">view source</a></div></div><div class="public anchor" id="var-cache-hit.21"><h3>cache-hit!</h3><div class="usage"><code>(cache-hit! url metadata-file metadata)</code></div><div class="doc"><pre class="plaintext">Handles a cache hit, by updating the :last-checked-at metadata.

Throws on IO errors.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L161">view source</a></div></div><div class="public anchor" id="var-cache-key-.3Ecache-file"><h3>cache-key-&gt;cache-file</h3><div class="usage"><code>(cache-key-&gt;cache-file cache-key)</code><code>(cache-key-&gt;cache-file cache-key extension)</code></div><div class="doc"><pre class="plaintext">Returns a File for the given cache-key (a String), optionally with the given
extension.  Return nil if cache-key is blank.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L39">view source</a></div></div><div class="public anchor" id="var-cache-miss.21"><h3>cache-miss!</h3><div class="usage"><code>(cache-miss! url opts)</code><code>(cache-miss! url already-redirected? {:keys [follow-redirects?], :or {follow-redirects? false}, :as opts})</code></div><div class="doc"><pre class="plaintext">Handles a cache miss, by downloading the content for the given url and
caching it locally, and also capturing metadata from the response for the
purposes of cache management in the future.

Throws on IO errors or unexpected HTTP status code responses.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L135">view source</a></div></div><div class="public anchor" id="var-check-cache.21"><h3>check-cache!</h3><div class="usage"><code>(check-cache! url {:keys [request-headers], :as opts})</code></div><div class="doc"><pre class="plaintext">Handles a potential cache hit, by determining whether the cached content
needs to be checked for staleness via an ETag request, or whether it can
simply be served directly.

Throws on IO errors or unexpected HTTP status code responses.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L169">view source</a></div></div><div class="public anchor" id="var-http-get"><h3>http-get</h3><div class="usage"><code>(http-get url)</code><code>(http-get url {:keys [connect-timeout read-timeout follow-redirects? request-headers], :or {connect-timeout 1000, read-timeout 1000, follow-redirects? false, request-headers {"User-Agent" "com.github.pmonks/urlocal"}}})</code></div><div class="doc"><pre class="plaintext">Perform an HTTP get request for the given URL, using the given options,
returning an HTTPUrlConnection object.

Throws on IO errors.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L113">view source</a></div></div><div class="public anchor" id="var-prep-cache.21"><h3>prep-cache!</h3><div class="usage"><code>(prep-cache! url opts)</code></div><div class="doc"><pre class="plaintext">Ensures the cache is populated for the given url.
</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L190">view source</a></div></div><div class="public anchor" id="var-remove-cache-entry.21"><h3>remove-cache-entry!</h3><div class="usage"><code>(remove-cache-entry! url)</code></div><div class="doc"><pre class="plaintext">Removes the cache entry for a single URL, if it exists. Returns nil.

Throws on IO errors.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L83">view source</a></div></div><div class="public anchor" id="var-seconds-since"><h3>seconds-since</h3><h4 class="type">multimethod</h4><div class="usage"><code>(seconds-since inst)</code></div><div class="doc"><pre class="plaintext">Returns how many seconds have passed since inst (a Date or Temporal), or nil
if inst is nil.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L94">view source</a></div></div><div class="public anchor" id="var-url-.3Econtent-file"><h3>url-&gt;content-file</h3><div class="usage"><code>(url-&gt;content-file url)</code></div><div class="doc"><pre class="plaintext">Returns a content file for the given url, or nil if the url is nil.
</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L47">view source</a></div></div><div class="public anchor" id="var-url-.3Emetadata-file"><h3>url-&gt;metadata-file</h3><div class="usage"><code>(url-&gt;metadata-file url)</code></div><div class="doc"><pre class="plaintext">Returns a metadata file for the given url, or nil if the url is nil.
</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L54">view source</a></div></div><div class="public anchor" id="var-write-metadata.21"><h3>write-metadata!</h3><div class="usage"><code>(write-metadata! url conn)</code></div><div class="doc"><pre class="plaintext">Writes out a metadata file for the given url, using the open connection for
that url.

Note: does nothing if the connection did not return an ETag - this ensures
that future requests to the same URL will always be treated as a cache miss.</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L67">view source</a></div></div><div class="public anchor" id="var-write-metadata-file.21"><h3>write-metadata-file!</h3><div class="usage"><code>(write-metadata-file! f m)</code></div><div class="doc"><pre class="plaintext">Writes the metadata m to the file f, overwriting it if it already exists.
</pre></div><div class="src-link"><a href="https://github.com/pmonks/urlocal/blob/main/src/urlocal/impl/cache.clj#L61">view source</a></div></div></div></body></html>